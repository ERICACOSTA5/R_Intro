---
title: "exp3"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
options(width = 90)
library(tidyverse)
# library(emmeans)
# library(multcomp)
```

```{r dataset}
sorg <- readr::read_csv("~/GitHub/R_Intro/data/sorgo.csv")
# write_csv(exp3, file.path("~/GitHub/R_Intro/data", "sorgo.csv"))
```

```{r dat to long, echo=FALSE}
long <- sorg %>%  
  gather(-(trt:planta),  
         key = "variable", value = "valor")
```

# Exploracion 

```{r}
# xtabs(~ ferti + cond + dias, long)

pd = position_dodge(width = 0.5)

long %>% drop_na(valor) %>% 

  ggplot(aes(x=factor(hibr), y=valor, group=trt, color=factor(trt))) +
  geom_jitter(alpha=0.5, size=0.8, width=0.2)+
  stat_summary(aes(group=trt), fun.data = mean_cl_boot,
               size = 0.05, position=pd) +
  stat_summary(aes(group=trt), size = 2,
               fun.y="mean", geom="point", position=pd, show.legend = FALSE)+
  facet_wrap(variable ~ ph, scales = "free")
  
# ggsave(filename = "exp3.png", 
#        path = "C:/Users/edwardsmolina.juan/Dropbox/Papers/1 In progress/sorgo_belen/plots")

```

# Componentes principales 

```{r}
library(GGally)
# sorg[,5:11]

ggpairs(sorg, columns = 5:11, ggplot2::aes(colour=ph),
    columnLabels = c("Altura", "Peso seco", "Fosforo total", "Zinc", "Nitrogeno", "Hierro", "Spad"))
```

```{r}
library(FactoMineR)

sorg$id <- paste0(substring(sorg$trt, 1, 1), sorg$hibr, ".",sorg$planta)
res.pca = PCA(sorg[,5:11], scale.unit=TRUE, ncp=5,graph=T)
plot.PCA(res.pca, axes=c(1, 2), choix="ind")
```


## Neutro

```{r}
# https://rpubs.com/Joaquin_AR/287787
neutro = data.frame(subset(exp3, ph=="neutro"))

neutro = na.omit(neutro)

neu <- neutro[,-11]
rownames(neu) <- neutro[,"id"]

res.pca = PCA(neu[,5:10], scale.unit=TRUE, ncp=5, graph=T)
plot.PCA(res.pca, axes=c(1, 2), choix="ind")
#scale.unit: to choose whether to scale the data or not 
#ncp: number of dimensions kept in the result
#graph: to choose whether to plot the graphs or not
```

## Alcalino

```{r}
alca = as.data.frame(subset(dat, pH=="alcalino"))
alc <- data.frame(alca[,-11], row.names=alca[,11])
pca2 <- prcomp(alc[complete.cases(alc), 5:10], scale = TRUE)
biplot(pca2)
summary(pca2)
```
